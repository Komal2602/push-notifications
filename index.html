<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enable Notifications</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- OneSignal SDK v16 -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 80px;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 10px;
    }

    p {
      font-size: 16px;
      color: #555;
    }

    button {
      margin-top: 30px;
      padding: 14px 28px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #4f46e5;
      color: #fff;
      cursor: pointer;
      display: none; /* shown only when needed */
    }

    button:hover {
      background-color: #4338ca;
    }
  </style>
</head>

<body>

  <h1>Enable Notifications</h1>
  <p>Please allow notifications to stay updated.</p>

  <button id="enableBtn" onclick="enableNotifications()">
    Enable Notifications
  </button>

  <script>
    /* üîÅ REPLACE THIS WITH YOUR REAL GLIDE NEW SCREEN LINK */
    const GLIDE_REDIRECT_URL = "https://geniuss-app-9vl4.glide.page/dl/64ffb1";

    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function (OneSignal) {

      await OneSignal.init({
        appId: "c382aeac-2c24-4112-ab16-99014b21b832",
        allowLocalhostAsSecureOrigin: true
      });

      // ‚úÖ v16 correct permission check
      const permission = await OneSignal.Notifications.permission;

      console.log("Notification permission:", permission);

      /* =================================================
         CONDITION A ‚Äî Already subscribed
         ================================================= */
      if (permission === "granted") {
        window.location.href = GLIDE_REDIRECT_URL;
        return;
      }

      /* =================================================
         CONDITION C ‚Äî Blocked
         ================================================= */
      if (permission === "denied") {
        window.location.href = GLIDE_REDIRECT_URL;
        return;
      }

      /* =================================================
         CONDITION B ‚Äî Not subscribed yet
         ================================================= */
      if (permission === "default") {
        document.getElementById("enableBtn").style.display = "inline-block";
      }
    });

    async function enableNotifications() {
      try {
        await OneSignal.Notifications.requestPermission();
      } catch (err) {
        console.log("Permission request error:", err);
      }

      // ‚úÖ After Allow OR Block ‚Üí redirect to Glide
      window.location.href = GLIDE_REDIRECT_URL;
    }
  </script>

</body>
</html>
